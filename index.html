<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Royal Photo Converter</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:linear-gradient(135deg,#1a0a2e 0%,#2d1b69 100%);color:#f8f8f8;min-height:100vh;padding:20px}
.container{max-width:1200px;margin:0 auto}
header{text-align:center;padding:30px 0}
.logo{font-size:3.5rem;color:#d4af37;margin-bottom:10px}
h1{font-size:2.8rem;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.5)}
.subtitle{font-size:1.2rem;color:#c9c1d6;max-width:600px;margin:0 auto 30px}
.main-content{display:flex;flex-wrap:wrap;gap:30px;margin-bottom:40px}
.upload-section,.edit-section{flex:1 1 300px;background:linear-gradient(145deg,#2d1b69 0%,#3c2a84 100%);border-radius:15px;padding:25px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
.section-title{font-size:1.5rem;margin-bottom:20px;color:#d4af37;display:flex;align-items:center;gap:10px}
.upload-area{border:3px dashed #8e7cc3;border-radius:12px;padding:40px 20px;text-align:center;cursor:pointer;transition:all .3s;margin-bottom:25px}
.upload-area:hover{background:rgba(142,124,195,.15)}
.btn{background:linear-gradient(to right,#d4af37 0%,#f1e5ac 100%);color:#1a0a2e;border:none;padding:12px 25px;border-radius:50px;font-weight:600;cursor:pointer;transition:all .3s}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(212,175,55,.4)}
.format-options{display:flex;flex-wrap:wrap;gap:15px;margin:20px 0}
.format-btn{background:rgba(255,255,255,.1);border:2px solid #8e7cc3;padding:10px 20px;border-radius:8px;color:#f8f8f8;cursor:pointer;flex:1;min-width:100px;text-align:center}
.format-btn.active{background:#d4af37;color:#1a0a2e;border-color:#d4af37}
.slider-container{margin:20px 0}
.slider-label{display:flex;justify-content:space-between;margin-bottom:8px}
.slider{width:100%;height:8px;-webkit-appearance:none;background:rgba(255,255,255,.1);border-radius:4px;outline:none}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#d4af37;cursor:pointer}
.preview-section{text-align:center;margin-top:30px}
.image-container{width:100%;max-width:600px;margin:0 auto;border:3px solid #8e7cc3;border-radius:12px;overflow:hidden;box-shadow:0 5px 20px rgba(0,0,0,.4)}
#image-preview{width:100%;display:block;max-height:400px;object-fit:contain}
.action-buttons{display:flex;justify-content:center;gap:20px;margin-top:30px}
.btn-download{background:linear-gradient(to right,#4caf50 0%,#8bc34a 100%)}
.btn-reset{background:linear-gradient(to right,#f44336 0%,#ff9800 100%)}
.loading-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:none;justify-content:center;align-items:center;flex-direction:column;color:#fff;font-size:1.5rem}
.spinner{border:5px solid rgba(255,255,255,.3);border-top:5px solid #d4af37;width:50px;height:50px;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:15px}
@keyframes spin{to{transform:rotate(360deg)}}
.notification{position:fixed;top:20px;right:20px;padding:15px 25px;background:linear-gradient(to right,#4caf50,#8bc34a);color:#fff;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.3);transform:translateX(100%);opacity:0;transition:all .3s;z-index:1000}
.notification.show{transform:translateX(0);opacity:1}
@media(max-width:768px){.main-content{flex-direction:column}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo"><i class="fas fa-crown"></i></div>
    <h1>Royal Photo Converter</h1>
    <p class="subtitle">Upload, convert, enhance and download your photos with ease.</p>
  </header>

  <div class="main-content">
    <!-- Upload -->
    <div class="upload-section">
      <h2 class="section-title"><i class="fas fa-upload"></i> Upload Photo</h2>
      <div class="upload-area" id="drop-area">
        <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
        <p>Drag & Drop your image here</p>
        <p>or</p>
        <input type="file" id="file-input" accept="image/*" hidden>
        <button class="btn" id="browse-btn"><i class="fas fa-folder-open"></i> Browse Files</button>
      </div>

      <h2 class="section-title"><i class="fas fa-wrench"></i> Conversion Settings</h2>
      <p>Select output format:</p>
      <div class="format-options">
        <div class="format-btn active" data-format="jpeg">JPG</div>
        <div class="format-btn" data-format="png">PNG</div>
        <div class="format-btn" data-format="webp">WEBP</div>
        <div class="format-btn" data-format="gif">GIF</div>
      </div>

      <div class="slider-container">
        <div class="slider-label"><span>Quality:</span><span id="quality-value">90%</span></div>
        <input type="range" min="1" max="100" value="90" class="slider" id="quality-slider">
      </div>

      <div class="slider-container">
        <div class="slider-label"><span>Max Width:</span><span id="width-value">Original</span></div>
        <input type="range" min="200" max="2000" step="100" value="2000" class="slider" id="width-slider">
      </div>

      <button class="btn" id="convert-btn"><i class="fas fa-sync-alt"></i> Convert Now</button>
    </div>

    <!-- Enhancements -->
    <div class="edit-section">
      <h2 class="section-title"><i class="fas fa-magic"></i> Enhancements</h2>
      <p>Apply filters:</p>
      <div class="format-options">
        <div class="format-btn active" data-filter="none">Original</div>
        <div class="format-btn" data-filter="sepia">Sepia</div>
        <div class="format-btn" data-filter="vintage">Vintage</div>
        <div class="format-btn" data-filter="grayscale">Grayscale</div>
        <div class="format-btn" data-filter="brighten">Brighten</div>
        <div class="format-btn" data-filter="invert">Invert</div>
      </div>
    </div>
  </div>

  <!-- Preview -->
  <div class="preview-section">
    <h2 class="section-title"><i class="fas fa-eye"></i> Preview</h2>
    <div class="image-container">
      <img id="image-preview" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzAzMDMwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzc4Nzg3OCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zNWVtIj5JbWFnZSBQcmV2aWV3PC90ZXh0Pjwvc3ZnPg==" alt="Preview">
      <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <p>Processing Imageâ€¦</p>
      </div>
    </div>
  </div>
</div>

<script>
// DOM
const fileInput = document.getElementById('file-input');
const dropArea   = document.getElementById('drop-area');
const browseBtn  = document.getElementById('browse-btn');
const convertBtn = document.getElementById('convert-btn');
const preview    = document.getElementById('image-preview');
const loading    = document.getElementById('loading-overlay');
const notify     = document.createElement('div'); notify.id='notification'; notify.className='notification'; document.body.appendChild(notify);

let selectedFile = null;
let selectedFormat = 'jpeg';
let selectedFilter = 'none';

// Events
browseBtn.onclick = () => fileInput.click();
fileInput.onchange = e => { selectedFile = e.target.files[0]; previewFile(); };
dropArea.ondragover = e => { e.preventDefault(); dropArea.style.background='rgba(142,124,195,.2)' };
dropArea.ondrop = e => { e.preventDefault(); dropArea.style.background=''; selectedFile=e.dataTransfer.files[0]; previewFile(); };

// Format buttons
document.querySelectorAll('.format-btn[data-format]').forEach(btn=>{
  btn.onclick = () => { document.querySelectorAll('.format-btn[data-format]').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); selectedFormat=btn.dataset.format; };
});
document.querySelectorAll('.format-btn[data-filter]').forEach(btn=>{
  btn.onclick = () => { document.querySelectorAll('.format-btn[data-filter]').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); selectedFilter=btn.dataset.filter; };
});

// Preview selected file
function previewFile() {
  if (!selectedFile || !selectedFile.type.startsWith('image/')) return;
  const reader = new FileReader();
  reader.onload = e => preview.src = e.target.result;
  reader.readAsDataURL(selectedFile);
}

// Convert
convertBtn.onclick = async () => {
  if (!selectedFile) { alert('Upload an image first'); return; }
  loading.style.display='flex';
  const form = new FormData();
  form.append('image', selectedFile);
  form.append('format', selectedFormat);
  form.append('quality', document.getElementById('quality-slider').value);
  form.append('width', document.getElementById('width-slider').value==2000 ? '' : document.getElementById('width-slider').value);
  form.append('filter', selectedFilter);

  try {
    const res = await fetch('/convert', {method:'POST', body:form});
    if (!res.ok) throw new Error('Conversion failed');
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    preview.src = url;
    // Offer download
    const a = document.createElement('a');
    a.href = url;
    a.download = `converted.${selectedFormat}`;
    a.click();
    showNotification('Converted successfully!');
  } catch(e) {
    alert(e.message);
  } finally {
    loading.style.display='none';
  }
};

function showNotification(msg) {
  notify.textContent = msg;
  notify.classList.add('show');
  setTimeout(()=>notify.classList.remove('show'), 3000);
}
</script>
</body>
</html>
